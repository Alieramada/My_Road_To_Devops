# Урок 2.3.2.

## &#x20;Введение

Операционная система Unix изначально была разработана для мэйнфреймов в середине 1960-х годов. Эти компьютеры были общими для многих пользователей, которые получали доступ к ресурсам системы через _терминалы_. Эти фундаментальные идеи применяются в системах Linux и сегодня. Мы все еще говорим об использовании “терминалов” для ввода команд в командной оболочке, и каждая система Linux организована таким образом, что легко создать множество пользователей в одной системе.

## &#x20;Домашние каталоги

Это пример обычной файловой системы в Linux:

```
$ tree -L 1 /
/
├── bin
├── boot
├── cdrom
├── dev
├── etc
├── home
├── lib
├── mnt
├── opt
├── proc
├── root
├── run
├── sbin
├── srv
├── sys
├── tmp
├── usr
└── var
```

Большинство этих каталогов одинаковы во всех системах Linux. От серверов до суперкомпьютеров и крошечных встраиваемых систем — опытный пользователь Linux может быть уверен, что найдёт команду `ls` внутри `/bin`, сможет изменить конфигурацию системы, изменив файлы в `/etc`, и прочитать системные журналы в `/var`. Стандартное расположение этих файлов и каталогов определяется стандартом иерархии файловых систем **Filesystem Hierarchy Standard (FHS)**, который будет рассмотрен в следующем уроке. Вы узнаете больше о содержимом этих каталогов по мере изучения Linux, но пока знайте, что:

* изменения, которые вы вносите в корневую файловую систему, затронут всех пользователей.
* для изменения файлов в корневой файловой системе потребуются разрешения администратора.

Это означает, что обычным пользователям будет запрещено изменять эти файлы, а также может быть запрещено даже читать эти файлы. Мы рассмотрим тему разрешений в следующем разделе.

Теперь мы сосредоточимся на каталоге `/home`, который на данном этапе должен быть вам знаком:

```
$ tree -L 1 /home
/home
├── user
├── michael
└── lara
```

В нашем примере в системе работают три обычных пользователя, и у каждого из наших пользователей есть свое собственное выделенное местоположение, где они могут создавать и изменять файлы и каталоги, не затрагивая своих соседей. Например, в предыдущем уроке мы работали со следующей файловой структурой:

```
$ tree /home/user
user
└── Documents
    ├── Mission-Statement
    └── Reports
        └── report2018.txt
```

На самом деле реальная файловая система может выглядеть следующим образом:

<pre><code><strong>$ tree /home
</strong>/home
├── user
│   └── Documents
│       ├── Mission-Statement
│       └── Reports
│           └── report2018.txt
├── michael
│   ├── Documents
│   │   └── presentation-for-clients.odp
│   └── Music
</code></pre>

... и так далее для `lara`.

В Linux `/home` похож на многоквартирный дом. У многих пользователей здесь может быть своё пространство, разделённое на отдельные квартиры. За коммунальные услуги и обслуживание самого здания отвечает пользователь root.

## &#x20;Специальный относительный путь для Home

Когда вы запускаете новый сеанс терминала в Linux, вы видите командную строку, похожую на эту:/

```
user@hostname ~ $
```

Тильда (`~`) здесь обозначает наш _домашний каталог_. Если вы выполните команду `ls`, то увидите знакомый результат:

```
$ cd ~
$ ls
Documents
```

Сравните это с файловой системой, описанной выше, чтобы проверить ваше понимание.

Теперь рассмотрим, что мы знаем о Linux: он похож на многоквартирный дом, в котором проживает много пользователей `/home`. Таким образом, дом `user` пользователя будет отличаться от дома `michael` пользователя. Чтобы продемонстрировать это, мы будем использовать `su` команду для _переключения пользователя_.

```
user@hostname ~ $ pwd
/home/user
user@hostname ~ $ su - michael
Password:
michael@hostname ~ $ pwd
/home/michael
```

Значение `~` меняется в зависимости от того, кто является пользователем. Для `michael` абсолютный путь `~` — `/home/michael`. Для `lara` абсолютный путь `~` — `/home/lara` и так далее.

## &#x20;Относительные пути к домашним файлам

Использование `~` для команд очень удобно при условии, что вы не переключаетесь между пользователями. Рассмотрим следующий пример для `user`:

```
$ ls
Documents
$ cd Documents
$ ls
Mission-Statement
Reports
$ cd Reports
$ ls
report2018.txt
$ cd ~
$ ls
Documents
```

Обратите внимание, что пользователи всегда будут начинать новый сеанс в своем домашнем каталоге. В этом примере `user` переместился в их `Documents/Reports` подкаталог, и с помощью `cd ~` команды они вернулись туда, откуда начали. Вы можете выполнить то же действие, используя `cd` команду без аргументов:

```
$ cd Documents/Reports
$ pwd
/home/user/Documents/Reports
$ cd
$ pwd
/home/user
```

Последнее, на что следует обратить внимание: мы можем указать домашние каталоги _других пользователей_, указав имя пользователя после тильды. Например:

```
$ ls ~michael
Documents
Music
```

Обратите внимание, что это сработает, только если `michael` дал нам разрешение на просмотр содержимого своего домашнего каталога.

Давайте рассмотрим ситуацию, когда `michael` хотелось бы просмотреть файл `report2018.txt` в  домашнем каталоге `user`. Предполагая, что у `michael` есть разрешение на это, он может использовать `less` команду.

```
$ less ~user/Documents/Reports/report2018.txt
```

Любой путь к файлу, содержащий `~` символ, называется _относительным к home_ путем.

## &#x20;Скрытые файлы и каталоги

В предыдущем уроке мы представили опцию `-a` для `ls` команды. Мы использовали `ls -a` для представления двух специальных относительных путей: `.` и `..`. `-a` Опция отобразит список _всех_ файлов и директорий, включая _скрытые_ файлы и директории.

```
$ ls -a ~
.
..
.bash_history
.bash_logout
.bash-profile
.bashrc
Documents
```

Скрытые файлы и каталоги всегда будут начинаться с точки (`.`). По умолчанию домашний каталог пользователя будет содержать множество скрытых файлов. Они часто используются для установки пользовательских настроек конфигурации и должны быть изменены только опытным пользователем.

## &#x20;Опции ls

Команда `ls` имеет множество опций для изменения своего поведения. Давайте рассмотрим одну из наиболее распространенных опций:

```
$ ls -l 
-rw-r--r-- 1 пользователь staff 3606 13 января 2017 report2018.txt
```

`-l` создает _длинный список_. Файлы и каталоги будут занимать по одной строке каждый, но будет отображаться дополнительная информация о каждом файле и каталоге.

`-rw-r—​r--`

Тип файла и права доступа к файлу. Обратите внимание, что обычный файл будет начинаться с dash( - ), а каталог с **`d`**.

`1`

Количество ссылок на файл.

`user staff`

Указывает владельца файла. `user` является владельцем файла, и файл также связан с группой `staff` .

`3606`

Размер файла в байтах.

`Jan 13 2017`

Отметка времени последнего изменения файла.

`report2018.txt`

Имя файла.

Такие темы, как владение, разрешения и ссылки, будут рассмотрены в будущих разделах. Как вы можете видеть, версия с длинным списком `ls` часто предпочтительнее версии по умолчанию.

## &#x20;Дополнительные опции ls

Ниже приведены некоторые способы, с помощью которых мы чаще всего используем команду `ls` . Как видите, пользователь может комбинировать множество параметров, чтобы получить желаемый результат.

`ls -lh`

Если объединить _длинный список_ с _удобными для восприятия человеком_ размерами файлов, мы получим полезные суффиксы, такие как `M` для мегабайтов или `K` для килобайтов.

`ls -d */`

Опция `-d` выводит список каталогов, но не их содержимое. В сочетании с `*/` будут отображаться только подкаталоги, но не файлы.

`ls -lt`

Объединяет _длинный список_ с возможностью сортировки по _времени изменения_. Файлы с самыми последними изменениями будут вверху, а файлы с самыми старыми изменениями — внизу. Но этот порядок можно изменить с помощью:

`ls -lrt`

Объединяет _длинный список_ с _сортировкой по времени (модификации)_, в сочетании с `-r` которым _сортировка инвертируется_. Теперь файлы с самыми последними изменениями находятся в нижней части списка. Помимо сортировки по времени _модификации_, файлы также можно сортировать по времени _доступа_ или по времени _состояния_.

`ls -lX`

Сочетает в себе _длинный список_ с возможностью сортировки по _расширению файла_. Это позволит, например, сгруппировать все файлы, оканчивающиеся на `.txt` вместе, все файлы, оканчивающиеся на `.jpg` вместе, и так далее.

`ls -S`

`-S` сортирует по _размеру_ файла, так же как `-t` и `-X` сортируют по времени и расширению соответственно. Самые большие файлы будут отображаться первыми, а самые маленькие — последними. Обратите внимание, что содержимое подкаталогов _не_ учитывается при сортировке.

`ls -R`

Опция `-R` изменит команду `ls` для отображения _рекурсивного_ списка. Что это значит?

## &#x20;Рекурсия в Bash

Рекурсия относится к ситуации, когда "что-то определяется или описывается с использованием самого себя в определении". Рекурсия - очень важное понятие в информатике, но здесь его значение намного проще. Давайте рассмотрим наш предыдущий пример.:

```
$ ls ~
Documents
```

Мы уже знали, что у `user` есть домашний каталог, и в этом каталоге есть один подкаталог. `ls` до сих пор нам показывали только файлы и подкаталоги местоположения, но не могли сообщить нам содержимое этих подкаталогов. В этих уроках мы использовали команду `tree`, когда хотели отобразить содержимое многих каталогов. К сожалению, `tree` не является одной из основных утилит Linux и поэтому не всегда доступна. Сравните результат `tree` с результатом `ls -R` в следующих примерах:

```
$ tree /home/user
user
└── Documents
    ├── Mission-Statement
    └── Reports
        └── report2018.txt

$ ls -R ~
/home/user/:
Documents

/home/user/Documents:
Mission-Statement
Reports

/home/user/Documents/Reports:
report2018.txt
```

Как видите, с помощью рекурсивной опции мы получаем гораздо более длинный список файлов. По сути, это похоже на то, как если бы мы запустили команду `ls` в домашнем каталоге `user` и обнаружили один подкаталог. Затем мы вошли в этот подкаталог и снова запустили команду `ls`. Мы обнаружили файл `Mission-Statement` и ещё один подкаталог под названием `Reports`. И снова мы вошли в подкаталог и снова запустили команду `ls`. По сути, запуск `ls -R` — это как если бы вы сказали Bash: «Запусти `ls` здесь и повтори команду в каждом найденном подкаталоге».

Рекурсия особенно важна в командах по изменению файлов, таких как копирование или удаление каталогов. Например, если вы хотите скопировать подкаталог `Documents`, вам нужно указать рекурсивную копию, чтобы распространить эту команду на все подкаталоги.

## &#x20;Упражнения с руководством

1. Используйте следующую файловую структуру, чтобы ответить на следующие три вопроса:

```
/
├── etc/
│   ├── network/
│   │   └── interfaces/
│   ├── systemd/
│   │   ├── resolved.conf
│   │   ├── system/
│   │   ├── system.conf
│   │   ├── user/
│   │   └── user.conf
│   └── udev/
│       ├── rules.d
│       └── udev.conf
└── home/
    ├── lost+found/
    ├── user/
    │   └── Documents/
    └── michael/
        └── Music/
```

* Какая команда будет выполнять переход в  каталог`network` независимо от вашего текущего местоположения?
* Какую команду может ввести `user` для перехода в свой `Documents` каталог из `/etc/udev`? Используйте кратчайший возможный путь.
* Какую команду нужно пользователю`user` ввести, чтобы перейти в каталог `michael` 's `Music`? Используйте кратчайший возможный путь.

2. Рассмотрим следующие выходные данные `ls -lh`, чтобы ответить на следующие два вопроса. Обратите внимание, что справочники обозначены символом `d` в начале строки.

```
drwxrwxrwx  5 eric eric  4.0K Apr 26  2011 China/
-rwxrwxrwx  1 eric eric  1.5M Jul 18  2011 img_0066.jpg
-rwxrwxrwx  1 eric eric  1.5M Jul 18  2011 img_0067.jpg
-rwxrwxrwx  1 eric eric  1.6M Jul 18  2011 img_0074.jpg
-rwxrwxrwx  1 eric eric  1.8M Jul 18  2011 img_0075.jpg
-rwxrwxrwx  1 eric eric   46K Jul 18  2011 scary.jpg
-rwxrwxrwx  1 eric eric  469K Jan 29  2018 Screenshot from 2017-08-13 21-22-24.png
-rwxrwxrwx  1 eric eric  498K Jan 29  2018 Screenshot from 2017-08-14 21-18-07.png
-rwxrwxrwx  1 eric eric  211K Jan 29  2018 Screenshot from 2018-01-06 23-29-30.png
-rwxrwxrwx  1 eric eric  150K Jul 18  2011 tobermory.jpg
drwxrwxrwx  6 eric eric  4.0K Apr 26  2011 Tokyo/
-rwxrwxrwx  1 eric eric  1.4M Jul 18  2011 Toronto 081.jpg
-rwxrwxrwx  1 eric eric  1.4M Jul 18  2011 Toronto 085.jpg
-rwxrwxrwx  1 eric eric  944K Jul 18  2011 Toronto 152.jpg
-rwxrwxrwx  1 eric eric  728K Jul 18  2011 Toronto 173.jpg
drwxrwxrwx  2 eric eric  4.0K Jun  5  2016 Wallpapers/
```

* Когда вы запускаете команду `ls -lrS`, какой файл будет находиться в начале?
* Пожалуйста, опишите, что вы ожидаете увидеть в качестве выходных данных для `ls -ad */`.

## &#x20;Исследовательские упражнения

1. Выполните команду `ls -lh` в каталоге, содержащем подкаталоги. Обратите внимание на размер этих каталогов. Вам кажется, что эти размеры файлов верны? Они точно отражают содержимое всех файлов в этом каталоге?
2. Вот новая команда, которую можно попробовать: `du -h`. Выполните эту команду и опишите полученный результат.
3. Во многих системах Linux вы можете ввести **`ll`** и получить тот же результат, что и при вводе `ls -l`. Однако обратите внимание, что **`ll`** _не является_ командой. Например, `man ll` выдаст сообщение о том, что для неё не существует инструкции. Это пример _псевдонима (alias)_. Зачем пользователю могут понадобиться псевдонимы?

## &#x20;Краткие сведения

В этой лабораторной работе вы узнали:

* что у каждого пользователя Linux будет домашний каталог,
* доступ к домашнему каталогу текущего пользователя можно получить с помощью `~`,
* любой путь к файлу, который использует `~`, называется _относительным к дому_ путем.

Вы также узнали о некоторых наиболее распространенных способах изменения команды \`ls .

`-a` (все)

печатает все файлы / каталоги, включая скрытые

`-d` (каталоги)

перечисляйте каталоги, а не их содержимое

`-h` (легко читается человеком)

выводит размеры файлов в удобочитаемом формате

`-l` (длинный список)

содержит дополнительные сведения, по одному файлу / каталогу в строке

`-r` (инверсия)

изменяет порядок сортировки на противоположный

`-R` (рекурсивный)

содержит список всех файлов, включая файлы в каждом подкаталоге

`-S` (размер)

сортировка по размеру файла

`-t` (время)

сортировка по времени модификации

`-X` (Расширение)

сортировка по расширению файла

## &#x20;Ответы на упражнения с руководством

1. Используйте следующую файловую структуру, чтобы ответить на следующие три вопроса:

```
/
├── etc/
│   ├── network/
│   │   └── interfaces/
│   ├── systemd/
│   │   ├── resolved.conf
│   │   ├── system/
│   │   ├── system.conf
│   │   ├── user/
│   │   └── user.conf
│   └── udev/
│       ├── rules.d
│       └── udev.conf
└── home/
    ├── lost+found/
    ├── user/
    │   └── Documents/
    └── michael/
        └── Music/
```

* Какая команда будет выполнять переход в  каталог`network` независимо от вашего текущего местоположения?

<pre><code><strong>cd /etc/network
</strong></code></pre>

* Какую команду может ввести `user` для перехода в свой `Documents` каталог из `/etc/udev`? Используйте кратчайший возможный путь.

```
cd ~/Documents
```

* Какую команду нужно пользователю`user` ввести, чтобы перейти в каталог `michael` 's `Music`? Используйте кратчайший возможный путь.

```
cd ~michael/Music
```

2. Рассмотрите следующий вывод `ls -lh` для ответа на следующие два вопроса. Обратите внимание, что каталоги обозначаются `d` в начале строки.

```
drwxrwxrwx  5 eric eric  4.0K Apr 26  2011 China/
-rwxrwxrwx  1 eric eric  1.5M Jul 18  2011 img_0066.jpg
-rwxrwxrwx  1 eric eric  1.5M Jul 18  2011 img_0067.jpg
-rwxrwxrwx  1 eric eric  1.6M Jul 18  2011 img_0074.jpg
-rwxrwxrwx  1 eric eric  1.8M Jul 18  2011 img_0075.jpg
-rwxrwxrwx  1 eric eric   46K Jul 18  2011 scary.jpg
-rwxrwxrwx  1 eric eric  469K Jan 29  2018 Screenshot from 2017-08-13 21-22-24.png
-rwxrwxrwx  1 eric eric  498K Jan 29  2018 Screenshot from 2017-08-14 21-18-07.png
-rwxrwxrwx  1 eric eric  211K Jan 29  2018 Screenshot from 2018-01-06 23-29-30.png
-rwxrwxrwx  1 eric eric  150K Jul 18  2011 tobermory.jpg
drwxrwxrwx  6 eric eric  4.0K Apr 26  2011 Tokyo/
-rwxrwxrwx  1 eric eric  1.4M Jul 18  2011 Toronto 081.jpg
-rwxrwxrwx  1 eric eric  1.4M Jul 18  2011 Toronto 085.jpg
-rwxrwxrwx  1 eric eric  944K Jul 18  2011 Toronto 152.jpg
-rwxrwxrwx  1 eric eric  728K Jul 18  2011 Toronto 173.jpg
drwxrwxrwx  2 eric eric  4.0K Jun  5  2016 Wallpapers/
```

* Когда вы запускаете команду `ls -lrS`, какой файл будет находиться в начале?

Все три папки имеют размер 4.0K, что является наименьшим размером файла. `ls` затем каталоги будут отсортированы по алфавиту по умолчанию. Правильный ответ - файл `scary.jpg`.

* Пожалуйста, опишите, что вы ожидаете увидеть в качестве выходных данных для `ls -ad */`

Эта команда покажет все подкаталоги, включая скрытые подкаталоги.

## &#x20;Ответы на исследовательские упражнения

1.  Выполните команду `ls -lh` в каталоге, содержащем подкаталоги. Обратите внимание на размер этих каталогов. Вам кажется, что эти размеры файлов верны? Они точно отражают содержимое всех файлов в этом каталоге?

    Нет, это не так. Каждый каталог имеет размер 4096 байт. Это связано с тем, что каталоги здесь являются абстракцией: они не существуют в виде древовидной структуры на диске. Когда вы видите каталог в списке, вы видите _**ссылку**_ на список файлов. Размер этих ссылок составляет **4096 байт**.
2.  Вот новая команда, которую можно попробовать: **`du -h`**. Запустите эту команду и опишите результат, который она вам дает.

    Команда **`du`** сгенерирует список всех файлов и каталогов и укажет размер каждого из них. Например, `du -s` отобразит размер всех файлов, каталогов и подкаталогов для определенного местоположения.
3.  Во многих системах Linux вы можете ввести `ll` и получить тот же результат, что и при вводе `ls -l`. Однако, пожалуйста, обратите внимание, что `ll` это _не_ команда. Например, `man ll` выдаст вам сообщение о том, что для нее не существует ручного ввода. Что это говорит вам о какой-либо функции командной строки?

    `ll` является _псевдонимом(alias)_ `ls -l`. В Bash мы можем использовать псевдонимы для упрощения часто используемых команд. `ll` часто определяется для вас в Linux, но вы также можете создать свой собственный.



