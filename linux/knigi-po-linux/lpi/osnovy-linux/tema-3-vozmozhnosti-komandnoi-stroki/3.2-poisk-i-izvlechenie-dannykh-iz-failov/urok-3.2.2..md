# Урок 3.2.2.

## Введение <a href="#sec.3.2_02-in" id="sec.3.2_02-in"></a>

В этом уроке мы рассмотрим инструменты, которые используются для работы с текстом. Эти инструменты часто применяются системными администраторами или программами для автоматического мониторинга или выявления повторяющейся информации.

## Поиск в файлах с помощью `grep` <a href="#searching_within_files_with_grep" id="searching_within_files_with_grep"></a>

Первый инструмент, о котором мы поговорим в этом уроке, — это команда `grep`. `grep` — это сокращение от фразы « печать глобального регулярного выражения global regular expression print», и её основная функция — поиск в файлах по заданному шаблону. Команда выводит строку, содержащую заданный шаблон, выделенный красным.

```sh
$ grep bash /etc/passwd
root:x:0:0:root:/root:/bin/bash
user:x:1001:1001:User,,,,:/home/user:/bin/bash
```

`grep`Как и большинство команд, эту можно настроить с помощью параметров. Вот наиболее распространённые из них:

`-i`

поиск выполняется без учета регистра

`-r`

поиск является рекурсивным (он выполняется во всех файлах в указанном каталоге и его подкаталогах)

`-c`

поиск подсчитывает количество совпадений

`-v`

инвертируйте соответствие, чтобы напечатать строки, которые не соответствуют поисковому запросу

`-E`

включает расширенные регулярные выражения (необходимы для некоторых более сложных метасимволов, таких как `|` , `+` и `?`)

`grep` Есть много других полезных опций. Чтобы узнать о них больше, обратитесь к справочной странице.

## Регулярные выражения <a href="#regular_expressions" id="regular_expressions"></a>

Второй инструмент очень мощный. Он используется для описания фрагментов текста в файлах и называется _регулярными выражениями_. Регулярные выражения чрезвычайно полезны для извлечения данных из текстовых файлов с помощью создания шаблонов. Они обычно используются в скриптах или при программировании на языках высокого уровня, таких как Perl или Python.

При работе с регулярными выражениями очень важно помнить, что _**каждый символ имеет значение**_, а шаблон пишется с целью сопоставления определённой последовательности символов, известной как строка. В большинстве шаблонов используются обычные символы ASCII, такие как буквы, цифры, знаки препинания или другие символы, но также могут использоваться символы Юникода для сопоставления с любым другим типом текста.

В следующем списке описаны метасимволы регулярных выражений, которые используются для формирования шаблонов.

`.`

Сопоставит любой отдельный символ (кроме новой строки)

`[abcABC]`

Сопоставит любой символ в квадратных скобках

`[^abcABC]`

Сопоставит любой символ, кроме тех, что заключены в квадратные скобки

`[a-z]`

Сопоставит любой символ в диапазоне

`[^a-z]`

Сопоставит любой символ, кроме тех, что находятся в диапазоне

`sun|moon`

Найдёт любую из перечисленных строк

`^`

Начало строки

`$`

Конец строки

Все функции регулярных выражений также могут быть реализованы с помощью `grep` . Вы можете заметить, что в приведённом выше примере слово не заключено в двойные кавычки. Чтобы оболочка не интерпретировала метасимвол, рекомендуется заключать более сложные шаблоны в двойные кавычки ("). Для практики мы будем использовать двойные кавычки при реализации регулярных выражений. Остальные кавычки сохраняют свою обычную функциональность, как обсуждалось в предыдущих уроках.

В следующих примерах показана функциональность регулярных выражений. Нам понадобятся данные из файла, поэтому следующий набор команд просто добавляет различные строки в файл `text.txt`.

```sh
$ echo "aaabbb1" > text.txt
$ echo "abab2" >> text.txt
$ echo "noone2" >> text.txt
$ echo "class1" >> text.txt
$ echo "alien2" >> text.txt
$ cat text.txt
aaabbb1
abab2
noone2
class1
alien2
```

Первый пример — это сочетание поиска в файле без регулярных выражений и с ними. Чтобы полностью понять регулярные выражения, очень важно показать разницу. Первая команда ищет точную строку в любом месте строки, а вторая команда ищет наборы символов, которые содержат любой из символов в скобках. Поэтому результаты команд отличаются.

```sh
$ grep "ab" text.txt
aaabbb1
abab2
$ grep "[ab]" text.txt
aaabbb1
abab2
class1
alien2
```

Во втором наборе примеров показано применение метасимволов начала и конца строки. Очень важно указать, что эти два символа должны находиться в нужном месте в выражении. При указании начала строки метасимвол должен находиться перед выражением, а при указании конца строки — после выражения.

```sh
$ grep "^a" text.txt
aaabbb1
abab2
alien2
$ grep "2$" text.txt
abab2
noone2
alien2
```

Помимо описанных выше метасимволов, в регулярных выражениях также есть метасимволы, которые позволяют многократно использовать ранее заданный шаблон:

`*`

Ноль или более из предыдущего шаблона

`+`

Один или несколько приведенных выше шаблонов

`?`

Ноль или один из предыдущих шаблонов

Приведённая ниже команда ищет строку, содержащую `ab`, один символ и один или несколько символов, найденных ранее. Результат показывает, что `grep` нашла строку `aaabbb1`, которая соответствует `abbb` и `abab2`. Поскольку символ `+` является _**расширенным**_ символом регулярного выражения, нам нужно передать `-E` в качестве параметра команде `grep`.

```sh
$ grep -E "ab.+" text.txt
aaabbb1
abab2
```

Большинство метасимволов понятны сами по себе, но при первом использовании они могут показаться сложными. Предыдущие примеры представляют собой лишь малую часть возможностей регулярных выражений. Попробуйте все метасимволы из приведённой выше таблицы, чтобы лучше понять, как они работают.

{% hint style="info" %}
От себя добавлю пару сайтов по которым удобно изучать регулярные выражения.&#x20;

[https://regexone.com/](https://regexone.com/)

[https://www.regular-expressions.info/tutorial.html](https://www.regular-expressions.info/tutorial.html)

[https://regexcrossword.com/](https://regexcrossword.com/)

[https://store.steampowered.com/app/1489660/Copy\_Editor\_A\_RegEx\_Puzzle/](https://store.steampowered.com/app/1489660/Copy\_Editor\_A\_RegEx\_Puzzle/)
{% endhint %}

## Упражнения с руководством <a href="#sec.3.2_02-ge" id="sec.3.2_02-ge"></a>

Используя `grep` и файл `/usr/share/hunspell/en_US.dic`, найдите строки, соответствующие следующим критериям:

1. Все строки, содержащие слово `cat` в любом месте строки.
2. Все строки, которые не содержат ни одного из следующих символов: `sawgtfixk`.
3. Все строки, начинающиеся с любых 3 букв и слова `dig`.
4. Все строки, которые заканчиваются хотя бы на одну `e`.
5. Все строки, содержащие одно из следующих слов: `org` , `kay` или `tuna`.
6. Количество строк, которые начинаются с одного или нескольких `c` с последующей строкой `ati`.

## Исследовательские упражнения <a href="#sec.3.2_02-ee" id="sec.3.2_02-ee"></a>

1. Найдите регулярное выражение, которое соответствует словам в строке «Включает» и не соответствует словам в строке «Исключить»:
   *   Включает: `pot`, `spot`, `apot`

       Исключить: `potic`, `spots`, `potatoe`
   *   Включает: `arp99`, `apple`, `zipper`

       Исключить: `zoo`, `arive`, `attack`
   *   Включает: `arcane`, `capper`, `zoology`

       Исключить: `air`, `coper`, `zoloc`
   *   Включает: `0th/pt`, `3th/tc`, `9th/pt`

       Исключить: `0/nm`, `3/nm`, `9/nm`
   *   Включает: `Hawaii`, `Dario`, `Ramiro`

       Исключить: `hawaii`, `Ian`, `Alice`
2. Какая ещё полезная команда обычно используется для поиска в файлах? Какие у неё дополнительные функции?
3. Вспомнив предыдущий урок, воспользуйтесь одним из примеров и попробуйте найти определённый шаблон в выводе команды с помощью `grep`.

## Краткие сведения <a href="#sec.3.2_02-su" id="sec.3.2_02-su"></a>

В этой лабораторной работе вы узнали:

* Метасимволы регулярных выражений
* Как создавать шаблоны с помощью регулярных выражений
* Как выполнять поиск в файлах

Команды, используемые в упражнениях:

`grep`

Выполняет поиск символов или строк в файле

## Ответы на упражнения с руководством <a href="#sec.3.2_02-age" id="sec.3.2_02-age"></a>

Используя `grep` и файл `/usr/share/hunspell/en_US.dic`, найдите строки, соответствующие следующим критериям:

1. Все строки, содержащие слово `cat` в любом месте строки.

```sh
$ grep "cat" /usr/share/hunspell/en_US.dic
Alcatraz/M
Decatur/M
Hecate/M
...
```

2. Все строки, которые не содержат ни одного из следующих символов: `sawgtfixk`.

```sh
$ grep -v «[sawgtfixk]» /usr/share/hunspell/en_US.dic
49269
0/nm
1/n1
2/nm
2nd/p
3/nm
3rd/p
4/nm
5/nm
6/nm
7/nm
8/nm
...
```

3. Все строки, начинающиеся с любых 3 букв и слова `dig`.

```sh
$ grep "^...dig" /usr/share/hunspell/en_US.dic
cardigan/SM
condign
predigest/GDS
...
```

4. Все строки, которые заканчиваются хотя бы на одну `e`.

```sh
$ grep -E "e+$" /usr/share/hunspell/en_US.dic
Anglicize
Anglophobe
Anthropocene
...
```

5. Все строки, содержащие одно из следующих слов: `org` , `kay` или `tuna`.

```sh
$ grep -E "org|kay|tuna" /usr/share/hunspell/en_US.dic
Borg/SM
George/MS
Tokay/M
fortunate/UY
...
```

6. Количество строк, которые начинаются с одного или нескольких `c` с последующей строкой `ati`.

```sh
$ grep -cE «^c?ati» /usr/share/hunspell/en_US.dic
3
```

## Ответы на исследовательские упражнения <a href="#sec.3.2_02-aee" id="sec.3.2_02-aee"></a>

1. Найдите регулярное выражение, которое соответствует словам в строке «Включить» и не соответствует словам в строке «Исключить»:
   *   Включает: `pot`, `spot`, `apot`

       Исключить: `potic`, `spots`, `potatoe`

       Ответ: `pot$`
   *   Включает: `arp99`, `apple`, `zipper`

       Исключить: `zoo`, `arive`, `attack`

       Ответ: `p+`
   *   Включает: `arcane`, `capper`, `zoology`

       Исключить: `air`, `coper`, `zoloc`

       Ответ: `arc|cap|zoo`
   *   Включает: `0th/pt`, `3th/tc`, `9th/pt`

       Исключить: `0/nm`, `3/nm`, `9/nm`

       Ответ: `[0-9]th.+`
   *   Включает: `Hawaii`, `Dario`, `Ramiro`

       Исключить: `hawaii`, `Ian`, `Alice`

       Ответ: `^[A-Z]a.*i+`
2.  Какая ещё полезная команда обычно используется для поиска в файлах? Какие у неё дополнительные функции?

    Команда `sed` Команда может находить и заменять символы или наборы символов в файле.
3.  Вспомнив предыдущий урок, воспользуйтесь одним из примеров и попробуйте найти определённый шаблон в выводе команды с помощью `grep`.

    Ваш ответ может отличаться в зависимости от выбранной вами команды и созданного вами шаблона.

```sh
$ cat contents.txt | tr -s " " | grep "^....rwx"
```

Это упражнение предназначено для того, чтобы показать вам, что `grep` также может получать ввод от различных команд и может помочь в фильтрации сгенерированной информации.

