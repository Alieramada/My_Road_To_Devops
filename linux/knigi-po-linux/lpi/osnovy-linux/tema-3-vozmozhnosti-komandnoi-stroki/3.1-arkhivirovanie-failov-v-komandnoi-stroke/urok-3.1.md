# Урок 3.1

## &#x20;Введение

Сжатие используется для уменьшения объема пространства, занимаемого определенным набором данных. Сжатие обычно используется для уменьшения объема пространства, необходимого для хранения файла. Еще одним распространенным способом использования является уменьшение объема данных, передаваемых по сетевому соединению.

Сжатие работает путем замены повторяющихся шаблонов в данных. Предположим, у вас есть роман. Некоторые слова чрезвычайно распространены, но состоят из нескольких символов, например, слово “the”. Вы могли бы значительно уменьшить размер романа, если бы заменили эти распространенные многосимвольные слова и шаблоны односимвольными заменами. Например, замените “the” греческой буквой, которая больше нигде в тексте не используется. Алгоритмы сжатия данных аналогичны этому, но более сложны.

Сжатие бывает двух видов: _без потерь_ и _с потерями_. Данные, сжатые с помощью алгоритма без потерь, можно распаковать обратно в исходную форму. Данные, сжатые с помощью алгоритма с потерями, восстановить невозможно. Алгоритмы с потерями часто используются для изображений, видео и аудио, где потеря качества незаметна для человека, не имеет значения для контекста или стоит того, чтобы сэкономить место или пропускную способность сети.

Инструменты архивирования используются для объединения файлов и каталогов в один файл. Наиболее распространённые варианты использования — резервное копирование, объединение исходного кода программного обеспечения и хранение данных.

Архивирование и сжатие обычно используются вместе. Некоторые инструменты для архивирования даже сжимают содержимое по умолчанию. Другие могут дополнительно сжимать содержимое. Некоторые инструменты для архивирования необходимо использовать в сочетании с автономными инструментами для сжатия, если вы хотите сжать содержимое.

Наиболее распространённым инструментом для архивирования файлов в системах Linux является `tar`. Большинство дистрибутивов Linux поставляются с версией `tar` от GNU, поэтому в этом уроке мы рассмотрим именно её. `tar` сам по себе только архивирует файлы, но не сжимает их.

В Linux доступно множество инструментов сжатия. Наиболее распространенными средствами сжатия без потерь являются `bzip2`, `gzip` и `xz`. Все три вы найдете в большинстве систем. Вы можете столкнуться со старой или очень минимальной системой, в которой не установлена `xz` или `bzip`. Если вы станете обычным пользователем Linux, вы, вероятно, столкнетесь с файлами, сжатыми всеми тремя из них. Все три из них используют разные алгоритмы, поэтому файл, сжатый одним инструментом, не может быть распакован другим. У инструментов сжатия есть компромисс. Если вам нужна высокая степень сжатия, на сжатие и распаковку файла уйдет больше времени. Это связано с тем, что при более высоком сжатии требуется больше работы по поиску более сложных шаблонов. Все эти инструменты сжимают данные, но не могут создавать архивы, содержащие несколько файлов.

Автономные средства сжатия обычно недоступны в системах Windows. Средства архивирования и сжатия Windows обычно поставляются в комплекте. Имейте это в виду, если у вас системы Linux и Windows, которым необходимо совместно использовать файлы.

В системах Linux также есть инструменты для обработки `.zip` файлов, обычно используемых в системе Windows. Они называются `zip` и `unzip`. Эти инструменты установлены по умолчанию не во всех системах, поэтому, если вам нужно их использовать, возможно, вам придется их установить. К счастью, они обычно находятся в репозиториях пакетов дистрибутивов.

## &#x20;Инструменты сжатия

Количество дискового пространства, которое можно сэкономить при сжатии файлов, зависит от нескольких факторов. От характера данных, которые вы сжимаете, алгоритма сжатия и уровня сжатия. Не все алгоритмы поддерживают разные уровни сжатия.

Давайте начнем с настройки некоторых тестовых файлов для сжатия:

```
$ mkdir ~/linux_essentials-3.1
$ cd ~/linux_essentials-3.1
$ mkdir compression archiving
$ cd compression
$ cat /etc/* > bigfile 2> /dev/null
```

Теперь мы создаем три копии этого файла:

```
Теперь мы создаем три копии этого файла:
```

<pre><code><strong>$ cp bigfile bigfile2
</strong><strong>$ cp bigfile bigfile3
</strong><strong>$ cp bigfile bigfile4
</strong><strong>$ ls -lh
</strong>total 2.8M
-rw-r--r-- 1 emma emma 712K Jun 23 08:08 bigfile
-rw-r--r-- 1 emma emma 712K Jun 23 08:08 bigfile2
-rw-r--r-- 1 emma emma 712K Jun 23 08:08 bigfile3
-rw-r--r-- 1 emma emma 712K Jun 23 08:08 bigfile4
</code></pre>

Теперь мы собираемся сжать файлы с помощью каждого вышеупомянутого инструмента сжатия:

```
$ bzip2 bigfile2
$ gzip bigfile3
$ xz bigfile4
$ ls -lh
total 1.2M
-rw-r--r-- 1 emma emma 712K Jun 23 08:08 bigfile
-rw-r--r-- 1 emma emma 170K Jun 23 08:08 bigfile2.bz2
-rw-r--r-- 1 emma emma 179K Jun 23 08:08 bigfile3.gz
-rw-r--r-- 1 emma emma 144K Jun 23 08:08 bigfile4.xz
```

Сравните размеры сжатых файлов с размерами несжатого файла с именем `bigfile`. Также обратите внимание, как инструменты сжатия добавили расширения к именам файлов и удалили несжатые файлы.

Используйте `bunzip2`, `gunzip` или `unxz` для распаковки файлов

```
$ bunzip2 bigfile2.bz2
$ gunzip bigfile3.gz
$ unxz bigfile4.xz
$ ls -lh
total 2.8M
-rw-r--r-- 1 emma emma 712K Jun 23 08:20 bigfile
-rw-r--r-- 1 emma emma 712K Jun 23 08:20 bigfile2
-rw-r--r-- 1 emma emma 712K Jun 23 08:20 bigfile3
-rw-r--r-- 1 emma emma 712K Jun 23 08:20 bigfile4
```

Обратите внимание еще раз, что теперь сжатый файл удаляется после его распаковки.

Некоторые инструменты сжатия поддерживают разные уровни сжатия. Более высокий уровень сжатия обычно требует больше памяти и циклов процессора, но приводит к уменьшению размера сжатого файла. Для более низкого уровня верно обратное. Ниже приведена демонстрация с `xz` и `gzip`:

```
$ cp bigfile bigfile-gz1
$ cp bigfile bigfile-gz9
$ gzip -1 bigfile-gz1
$ gzip -9 bigfile-gz9
$ cp bigfile bigfile-xz1
$ cp bigfile bigfile-xz9
$ xz -1 bigfile bigfile-xz1
$ xz -9 bigfile bigfile-xz9
$ ls -lh bigfile bigfile-* *
total 3.5M
-rw-r--r-- 1 emma emma 712K Jun 23 08:08 bigfile
-rw-r--r-- 1 emma emma 205K Jun 23 13:14 bigfile-gz1.gz
-rw-r--r-- 1 emma emma 178K Jun 23 13:14 bigfile-gz9.gz
-rw-r--r-- 1 emma emma 156K Jun 23 08:08 bigfile-xz1.xz
-rw-r--r-- 1 emma emma 143K Jun 23 08:08 bigfile-xz9.xz
```

Нет необходимости распаковывать файл каждый раз, когда вы его используете. Инструменты сжатия обычно поставляются со специальными версиями распространённых инструментов, используемых для чтения текстовых файлов. Например, `gzip` имеет версии `cat`, `grep`, `diff`, `less`, `more` и несколько других. Для `gzip` инструменты имеют префикс `z`, а префикс `bz` существует для `bzip2` и `xz` существует для `xz`. Ниже приведён пример использования `zcat` для чтения и отображения файла, сжатого с помощью `gzip`:

```
$ cp /etc/hosts ./
$ gzip hosts
$ zcat hosts.gz
127.0.0.1	localhost

# The following lines are desirable for IPv6 capable hosts
::1     localhost ip6-localhost ip6-loopback
ff02::1 ip6-allnodes
ff02::2 ip6-allrouters
```



